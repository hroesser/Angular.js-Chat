"use strict";angular.module("chatApp",["chatApp.configuration","chatApp.controllers","chatApp.sockethelper","chatApp.services","chatApp.helpers","chatApp.filters","chatApp.directives","btford.socket-io"]),angular.module("chatApp.configuration",[]).constant("appConf",{maxChatMessages:45,maxServerMessages:10,minChatCharacter:4}),angular.module("chatApp.controllers",[]).controller("chatAppCtrl",function(a,b,c,d,e,f,g,h,i){var j=[];a.showChatBar=!1,a.showLogin=!0,a.privateMessageTo="",a.chatText="",a.soundInit="on",a.disable_send="disabled",a.disable_logout="disabled",a.disable_login="",a.divValue2="myDivValue",a.divValue="6",a.toggleSound=function(a){i.toggleSoundState(a)},a.togglePm=function(b,c,d){h.toggleUserState(d,c,b);var e=h.getUserByIndex(d);console.log("CTRL: <togglePm>ustate is now "+JSON.stringify(e)),a.participants.users[d].state=e.state,"privateTo"==e.state?(a.privateMessageTo=e.name+": ",console.log("CTRL:should set PM ON now")):(a.privateMessageTo="",console.log("CTRL:should set PM OFF now"))},b.on("statusMessage",function(b){a.serverStatus=b.status,a.serverGreeting=b.text,b.loggedIn===!0&&(console.log("#33 successfuly loged in, n: "+b.chatName),a.showChatBar=!0,a.showLogin=!1,a.disable_send="",a.disable_logout="disabled",a.disable_login="disabled",a.chatText="",e.setUserObj("chatName",b.chatName),e.setUserObj("loggedIn",!0))}),b.on("chatMessage",function(b){if(console.log(" on chatMsg: ang.controller #15: "+JSON.stringify(b)),console.log(" on chatMsg: playing sound => "),!0===e.isLoggedIn()){switch(b.messagePre="",b.fromUserClass="",b.type){case"privateSelf":b.messagePre="to: "+e.isPrivateTo()+" ",i.playChatSound("chatMsg");break;case"privateTo":b.messagePre="",b.fromUserClass="text-orange",i.playChatSound("chatMsg")}j.push(b),f.pushChatMessage(b),a.messages=f.getChatMessages(),console.log(" #103  Im lggedin   ")}else console.log(" #107  im lgged out ")}),b.on("userList",function(b){e.isLoggedIn()&&(console.log(" #58 userlist "+JSON.stringify(b)),h.setUsers(b),a.participants={users:h.getUsers(),userCount:b.usercount})}),b.on("serverMessage",function(b){e.isLoggedIn()&&(g.pushServerMessage(b),b.logoutMessage&&b.logoutUser==e.getUserObj("privateTo")&&e.isInPrivate()&&console.log("#### 73 Server calls togglePmOff for user: "+b.logoutUser),a.serverMessages=g.getServerMessages(),console.log(" #76 serv.msg comp "+JSON.stringify(a.serverMessages)))}),a.emitLogin=function(){console.log(" emitLogin() uobj :"+JSON.stringify(e.getEntireUserObj())),b.emit("login",{name:a.chatName})},a.emitLogout=function(){console.log(" emitLogout() uobj :"+JSON.stringify(e.getEntireUserObj())),e.isLoggedIn()&&(b.emit("logout",{name:e.getUserObj("chatName")}),a.showChatBar=!1,a.showLogin=!0,a.disable_send="disabled",a.disable_logout="disabled",a.disable_login="",a.participants={},e.logOut())},a.emitChat=function(c){console.log(" emitChat() kev: "+JSON.stringify(c)),console.log(" emitChat() userObJ: "+JSON.stringify(e.getEntireUserObj()));var d="",f=!1,g=e.getUserObj("chatName");e.isInPrivate()&&(d=e.isPrivateTo(),console.log(" emitChat() userObJ: appears to be priv. to "+d),f=!0),b.emit("userMessage",{name:g,text:a.chatText.trim(),isPrivate:f,privateTo:d}),a.chatText="";var h=$("#main"),i=$(window).height()-120-$("#talk-box-output").innerHeight();0>=i&&$("html, body").animate({scrollTop:h.height()},1100)}}),angular.module("chatApp.directives",[]).directive("divUser",function(){function a(a,b,c){a.toggleState=function(b,c,d){a.callCtrl({name:b,state:c,index:d})}}return{restrict:"A",link:a,scope:{callCtrl:"&callbackController",user:"=user"},template:'<div class="{{user.style}}" ><div class="circle-header14" ></div><span ng-click="toggleState(user.name,user.state,user.index)">{{user.name}}</span></div>'}}).directive("speaker",function(){function a(a,b,c){a.toggleSnd=function(){var c=b,d=c.children(0).children(0),e=d.attr("class"),f=c.attr("sound");"on"==f?(d.attr("class","sound-off"),d.attr("title","play"),c.attr("sound","off"),a.callCtrlFn({switchTo:"mute"}),console.log("## dir: togl sound OFF cc "+e+" st "+f)):(d.attr("class","sound-on"),d.attr("title","mute"),c.attr("sound","on"),a.callCtrlFn({switchTo:"play"}),console.log("## dir: togl sound ON cc "+e+" st  "+f))}}return{restrict:"A",link:a,scope:{callCtrlFn:"&callbackController"},template:'<div class="sound" ><span id="speaker" ng-click="toggleSnd()" class="sound-on" title="mute"></span></div>'}}),angular.module("chatApp.filters",[]).filter("interpolate",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}),angular.module("chatApp.helpers",[]).service("chatHelpers",function(){return{formatTime:function(a){var b=new Date(a),c="";return b.getHours()<10&&(c+="0"),c+=b.getHours(),c+=":",b.getMinutes()<10&&(c+="0"),c+=b.getMinutes()}}}),angular.module("chatApp.sockethelper",[]).factory("socketRefact",function(a){var b=io.connect();return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}}).factory("socket",function(a){var b=io.connect(),c=a({ioSocket:b});return c}),angular.module("chatApp.services",[]).factory("soundService",function(){var a=document.getElementById("chatAudio"),b=(document.getElementById("speaker"),{joinSound:"",leaveSound:"",chatSound:"../sound/chat.ogg",privateMessageSound:""});return{playChatSound:function(c){if(!this.mute)switch(c){case"chatMsg":a.src=b.chatSound,a.play();break;case"privMsg":a.src=b.privateMessageSound,a.play()}},playPMSound:function(){a.src=b.privateMessageSound,this.mute||a.play()},toggleSoundState:function(a){"mute"==a?(console.log("# soundservice: snd was ON, switch sound MUTE > arg:"+a),this.mute=!0):(this.mute=!1,console.log("# soundservice : snd was OFF, switch sound ON typ: "+a))},isMuted:function(){return this.mute},muteMe:function(){this.mute=!0},muteOff:function(){this.mute=!1}}}).factory("userService",function(){var a={chatName:"",setPrivate:!1,privateTo:"",loggedIn:!1};return{setUserObj:function(b,c){a[b]=c},getUserObj:function(b){return a[b]},isLoggedIn:function(){return a.loggedIn},isInPrivate:function(){return a.setPrivate},isPrivateTo:function(){return a.privateTo},logIn:function(){a.loggedIn=!0},logOut:function(){a.loggedIn=!1},setEntireUserObj:function(b){a=b},getEntireUserObj:function(){return a}}}).factory("handlerChatMessages",function(a,b){var c=[];return{pushChatMessage:function(d){d.time=a.formatTime(d.time),c.push(d),c.length>b.maxChatMessages&&c.slice(0,1)},getChatMessages:function(){return c},getChatMessage:function(a){return c[a]},resetChatMessages:function(){c=[]}}}).factory("handlerServerMessages",function(a,b){var c=[];return{pushServerMessage:function(d){d.time=a.formatTime(d.time),c.push(d),console.log("  handlServMsg: push data. lenght:  "+c.length),c.length>b.maxServerMessages&&(c=c.slice(1,c.length),console.log("  slicing 1st serverMsg:  "))},getServerMessages:function(){return c},getServerMessage:function(a){return c[a]},resetServerMessages:function(){c=[]}}}).factory("handlerUserlist",function(a,b){var c=[],d={};return{setUsers:function(a){c=[];for(var e in a.users)d={},d.style="",d.name=a.users[e],d.index=e,b.getUserObj("chatName")===a.users[e]?(d.state="self",d.style="online-user-current"):b.isInPrivate&&b.isPrivateTo===a.users[e]?(d.state="privateTo",d.style="online-user-pm"):(d.state="norm",d.style="online-user-norm"),c.push(d)},toggleUserState:function(a,d,e){switch(d){case"norm":c[a].state="privateTo",c[a].style="online-user-pm",b.setUserObj("setPrivate",!0),b.setUserObj("privateTo",e);break;case"privateTo":c[a].state="norm",c[a].style="online-user-norm",b.setUserObj("setPrivate",!1),b.setUserObj("privateTo","")}},getUsers:function(){return c},getUserByIndex:function(a){return c[a]},resetUserlist:function(){c=[]}}}),function(a){a.fn.simpleClock=function(b){function c(){var a=new Date,b=a.getHours();return{day:g[f][a.getDay()],date:a.getDate(),month:h[f][a.getMonth()],hour:d(b),minute:d(a.getMinutes())}}function d(a){return 10>a?"0"+a:a}function e(){var b=c(),d={en:b.day+", "+b.month+" "+b.date+".",de:b.day+", "+b.date+". "+b.month};a("#date").html(d[f]),a("#time").html("<span class='hour'>"+b.hour+":</span><span class='minute'>"+b.minute+"</span>")}var f=b,g={},h={};g.de=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],h.de=["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],g.en=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h.en=["January","February","March","April","May","June","July","August","September","October","November","December"],e(),setInterval(e,1e3)}}(jQuery);