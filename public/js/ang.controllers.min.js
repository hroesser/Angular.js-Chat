/*! Angular-Chat (c) Hermann RÃ¶sser License: MIT 2016-07-08 */
"use strict";angular.module("chatApp.controllers",[]).controller("chatAppCtrl",function($scope,socket,chatHelpers,appConf,userService,handlerChatMessages,handlerServerMessages,handlerUserlist,soundService){var chatMessages=[];$scope.showChatBar=!1,$scope.showLogin=!0,$scope.privateMessageTo="",$scope.chatText="",$scope.soundInit="on",$scope.disable_send="disabled",$scope.disable_logout="disabled",$scope.disable_login="",$scope.toggleSound=function(switchTo){soundService.toggleSoundState(switchTo)},$scope.togglePm=function(user,state,index){handlerUserlist.toggleUserState(index,state,user);var userState=handlerUserlist.getUserByIndex(index);$scope.participants.users[index].state=userState.state,"privateTo"==userState.state?$scope.privateMessageTo=userState.name+": ":$scope.privateMessageTo=""},socket.on("statusMessage",function(message){$scope.serverStatus=message.status,$scope.serverGreeting=message.text,message.loggedIn===!0&&($scope.showChatBar=!0,$scope.showLogin=!1,$scope.disable_send="",$scope.disable_logout="disabled",$scope.disable_login="disabled",$scope.chatText="",userService.setUserObj("chatName",message.chatName),userService.setUserObj("loggedIn",!0))}),socket.on("chatMessage",function(message){if(!0===userService.isLoggedIn()){switch(message.messagePre="",message.fromUserClass="",message.type){case"privateSelf":message.messagePre="to: "+userService.isPrivateTo()+" ",soundService.playChatSound("chatMsg");break;case"privateTo":message.messagePre="",message.fromUserClass="text-orange",soundService.playChatSound("chatMsg")}chatMessages.push(message),handlerChatMessages.pushChatMessage(message),$scope.messages=handlerChatMessages.getChatMessages()}}),socket.on("userList",function(data){userService.isLoggedIn()&&(handlerUserlist.setUsers(data),$scope.participants={users:handlerUserlist.getUsers(),userCount:data.usercount})}),socket.on("serverMessage",function(data){userService.isLoggedIn()&&(handlerServerMessages.pushServerMessage(data),data.logoutMessage&&data.logoutUser==userService.getUserObj("privateTo")&&userService.isInPrivate(),$scope.serverMessages=handlerServerMessages.getServerMessages())}),$scope.emitLogin=function(){socket.emit("login",{name:$scope.chatName})},$scope.emitLogout=function(){userService.isLoggedIn()&&(socket.emit("logout",{name:userService.getUserObj("chatName")}),$scope.showChatBar=!1,$scope.showLogin=!0,$scope.disable_send="disabled",$scope.disable_logout="disabled",$scope.disable_login="",$scope.participants={},userService.logOut())},$scope.emitChat=function(type){var pmGoesTo="",priv=!1,chatName=userService.getUserObj("chatName");userService.isInPrivate()&&(pmGoesTo=userService.isPrivateTo(),priv=!0),socket.emit("userMessage",{name:chatName,text:$scope.chatText.trim(),isPrivate:priv,privateTo:pmGoesTo}),$scope.chatText="";var elem=$("#main"),gap=$(window).height()-120-$("#talk-box-output").innerHeight();0>=gap&&$("html, body").animate({scrollTop:elem.height()},1100)}});